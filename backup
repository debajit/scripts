#!/usr/bin/env bash

#
# backup - Backs up important files that are generally not in git, git annex, or a BtrFS snapshot.
#
# SYNOPSIS
#   backup
#
# DESCRIPTION
#   Uses borg to backup a variety of important files. These are mostly
#   user-files (with a few important system files for reference) that
#   are typically
#
#   - Not under revision control. This may include important
#     work-in-progress documents (like notes) that have not been
#     synced to the git upstream for instance.
#
#   - Not git-annexed
#
#   - Not backed up by the default BtrFS system snapshots (managed by
#     Timeshift for instance)
#

set -euxo pipefail

borg create -v --stats --progress --exclude-from $HOME/.borg-exclude.lst ::'archive-{hostname}-{now}' \
    $HOME/.emacs.d \
    $HOME/.zsh* \
    $HOME/.zprofile \
    $HOME/.aliases* \
    $HOME/.env_vars* \
    $HOME/.paths* \
    $HOME/.app-config* \
    $HOME/.config/cmus/* \
    $HOME/.config/espanso/* \
    $HOME/.config/ranger/* \
    $HOME/.config/rclone/* \
    $HOME/{.config,.local/share}/liferea \
    $HOME/.hunspell_en_US \
    $HOME/.local/share/Anki2 \
    $HOME/.local/share/fonts/* \
    $HOME/Archive/Knowledge \
    $HOME/Projects \
    $HOME/.ssh/config \
    /boot \
    /etc/fstab \
    /etc/hosts \
    /etc/mkinitcpio* \
    /etc/ssh/sshd_config

# TODO: Prune old backups. Remember to take the clientname into account
